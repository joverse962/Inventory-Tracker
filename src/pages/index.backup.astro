---
import BaseLayout from '../layouts/BaseLayout.astro';
import ItemCard from '../components/ItemCard.astro';
import FilterBar from '../components/FilterBar.astro';
import BarcodeScanner from '../components/BarcodeScanner.astro';

// Sample inventory data with components/sets
const items = [
  { 
    id: 1, 
    name: 'Dell Laptop XPS 15', 
    status: 'available', 
    photo: 'https://images.unsplash.com/photo-1588872657578-7efd1f1555ed?w=400',
    currentUser: null,
    location: 'Warehouse A',
    category: 'Electronics',
    description: 'High-performance laptop with 16GB RAM and 512GB SSD',
    components: [
      { name: 'Charger', quantity: 1 },
      { name: 'Mouse', quantity: 1 },
      { name: 'Carrying Case', quantity: 1 }
    ]
  },
  { 
    id: 2, 
    name: 'Epson Projector', 
    status: 'borrowed', 
    photo: 'https://images.unsplash.com/photo-1559827260-dc66d52bef19?w=400',
    currentUser: 'John Doe',
    location: 'Office Floor 1',
    category: 'Electronics',
    description: '4K projector with HDMI and wireless connectivity',
    components: [
      { name: 'Power Cable', quantity: 1 },
      { name: 'HDMI Cable', quantity: 1 },
      { name: 'Remote Control', quantity: 1 }
    ]
  },
  { 
    id: 3, 
    name: 'Mechanical Keyboard', 
    status: 'used', 
    photo: 'https://images.unsplash.com/photo-1587829741301-dc798b83add3?w=400',
    currentUser: null,
    location: 'Office Floor 2',
    category: 'Office Supplies',
    description: 'RGB mechanical keyboard with blue switches'
  },
  { 
    id: 4, 
    name: 'HP Printer LaserJet', 
    status: 'waste', 
    photo: 'https://images.unsplash.com/photo-1612815154858-60aa4c59eaa6?w=400',
    currentUser: null,
    location: 'Warehouse B',
    category: 'Electronics',
    description: 'Old printer - marked for disposal'
  },
  { 
    id: 5, 
    name: 'Office Desk', 
    status: 'available', 
    photo: 'https://images.unsplash.com/photo-1518455027359-f3f8164ba6bd?w=400',
    currentUser: null,
    location: 'Warehouse A',
    category: 'Furniture',
    description: 'Adjustable standing desk'
  },
  { 
    id: 6, 
    name: 'Ergonomic Chair', 
    status: 'borrowed', 
    photo: 'https://images.unsplash.com/photo-1580480055273-228ff5388ef8?w=400',
    currentUser: 'Jane Smith',
    location: 'Office Floor 1',
    category: 'Furniture',
    description: 'Herman Miller Aeron chair'
  },
  { 
    id: 7, 
    name: 'Tool Set', 
    status: 'available', 
    photo: 'https://images.unsplash.com/photo-1530124566582-a618bc2615dc?w=400',
    currentUser: null,
    location: 'Warehouse B',
    category: 'Tools',
    description: 'Complete screwdriver and wrench set',
    components: [
      { name: 'Screwdrivers', quantity: 8 },
      { name: 'Wrenches', quantity: 6 },
      { name: 'Pliers', quantity: 3 },
      { name: 'Tool Box', quantity: 1 }
    ]
  },
  { 
    id: 8, 
    name: 'Whiteboard', 
    status: 'used', 
    photo: 'https://images.unsplash.com/photo-1611532736597-de2d4265fba3?w=400',
    currentUser: null,
    location: 'Office Floor 2',
    category: 'Office Supplies',
    description: 'Large whiteboard with markers'
  },
];

// Get stats
const stats = {
  total: items.length,
  available: items.filter(i => i.status === 'available').length,
  borrowed: items.filter(i => i.status === 'borrowed').length,
  used: items.filter(i => i.status === 'used').length,
  waste: items.filter(i => i.status === 'waste').length,
};
---

<BaseLayout>
  <div class="mb-6 flex justify-between items-center">
    <h2 class="text-3xl font-bold">ğŸ“¦ Inventory Dashboard</h2>
    <BarcodeScanner />
  </div>

  <!-- Stats Cards -->
  <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6">
    <div class="bg-white p-4 rounded-lg shadow">
      <p class="text-gray-500 text-sm">Total Items</p>
      <p class="text-2xl font-bold">{stats.total}</p>
    </div>
    <div class="bg-green-100 p-4 rounded-lg shadow">
      <p class="text-green-700 text-sm">âœ… Available</p>
      <p class="text-2xl font-bold text-green-700">{stats.available}</p>
    </div>
    <div class="bg-yellow-100 p-4 rounded-lg shadow">
      <p class="text-yellow-700 text-sm">ğŸ“¤ Borrowed</p>
      <p class="text-2xl font-bold text-yellow-700">{stats.borrowed}</p>
    </div>
    <div class="bg-gray-100 p-4 rounded-lg shadow">
      <p class="text-gray-700 text-sm">ğŸ”§ Used</p>
      <p class="text-2xl font-bold text-gray-700">{stats.used}</p>
    </div>
    <div class="bg-red-100 p-4 rounded-lg shadow">
      <p class="text-red-700 text-sm">ğŸ—‘ï¸ Waste</p>
      <p class="text-2xl font-bold text-red-700">{stats.waste}</p>
    </div>
  </div>

  <!-- Filter Bar -->
  <FilterBar />

  <!-- Items Grid -->
  <div id="items-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
    {items.map(item => <ItemCard item={item} />)}
  </div>

  <!-- No results message -->
  <div id="no-results" class="hidden text-center py-12">
    <p class="text-gray-500 text-lg">No items found matching your filters</p>
    <button onclick="resetFilters()" class="mt-4 text-blue-500 hover:text-blue-700">Clear all filters</button>
  </div>

  <!-- Filter Script -->
  <script is:inline define:vars={{ items }}>
    const allItems = items;
    
    window.filterItems = function() {
      const search = document.querySelector('[x-model="search"]')?.value?.toLowerCase() || '';
      const statusFilter = document.querySelector('[x-model="statusFilter"]')?.value || 'all';
      const categoryFilter = document.querySelector('[x-model="categoryFilter"]')?.value || 'all';
      const locationFilter = document.querySelector('[x-model="locationFilter"]')?.value || 'all';
      
      const filtered = allItems.filter(item => {
        const matchesSearch = !search || 
          item.name.toLowerCase().includes(search) ||
          (item.description && item.description.toLowerCase().includes(search)) ||
          (item.currentUser && item.currentUser.toLowerCase().includes(search));
        
        const matchesStatus = statusFilter === 'all' || item.status === statusFilter;
        const matchesCategory = categoryFilter === 'all' || item.category === categoryFilter;
        const matchesLocation = locationFilter === 'all' || item.location === locationFilter;
        
        return matchesSearch && matchesStatus && matchesCategory && matchesLocation;
      });
      
      // Show/hide items
      const grid = document.getElementById('items-grid');
      const noResults = document.getElementById('no-results');
      const cards = grid.querySelectorAll('[x-data]');
      
      let visibleCount = 0;
      cards.forEach((card, index) => {
        const shouldShow = filtered.some(item => item.id === allItems[index].id);
        card.style.display = shouldShow ? 'block' : 'none';
        if (shouldShow) visibleCount++;
      });
      
      // Show/hide no results message
      if (visibleCount === 0) {
        noResults.classList.remove('hidden');
      } else {
        noResults.classList.add('hidden');
      }
    };
    
    window.resetFilters = function() {
      document.querySelector('[x-model="search"]').value = '';
      document.querySelector('[x-model="statusFilter"]').value = 'all';
      document.querySelector('[x-model="categoryFilter"]').value = 'all';
      document.querySelector('[x-model="locationFilter"]').value = 'all';
      window.filterItems();
    };
  </script>
</BaseLayout>
